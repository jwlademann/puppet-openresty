#
# This file has been generated by Puppet
# Don't edit directly
#
 server {
        listen <%= @listen_ip %>:<%= @listen_port %>;
        lua_code_cache off;

        <% if @nginx_resolver %>
                resolver <% @nginx_resolver %>;
        <% end %>
        access_by_lua_file '<%= @nginx_base_dir %>/conf/access.lua';
        
        header_filter_by_lua 'ngx.header.content_length = nil';
        body_filter_by_lua_file '<%= @nginx_base_dir %>/conf/analytics.lua';

        error_page 401 /login;
        error_page 403 /not-authorised;
        error_page 404 /page-not-found;
        error_page 500 /error;

        proxy_set_header  Host             $http_host;
        proxy_set_header  X-Real-IP        $remote_addr;
        proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;


<%= @locations -%>

}
